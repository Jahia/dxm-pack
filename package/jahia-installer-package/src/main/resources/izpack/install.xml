<?xml version="1.0" encoding="UTF-8"?>
<installation version="1.0">
    <info>
        <appname>${product.name}</appname>
        <appversion>${project.version}</appversion>
        <authors>
            <author email="${jahia.manifest.vendor.email}" name="${jahia.manifest.vendor.name}"/>
        </authors>
        <url>${jahia.manifest.vendor.url}</url>
        <uninstaller name="uninstaller.jar" write="yes"/>
        <javaversion>1.5</javaversion>
        <requiresjdk>no</requiresjdk>
        <writeinstallationinformation>no</writeinstallationinformation>
        <run-privileged condition="izpack.windowsinstall.vista|izpack.windowsinstall.7"/>
        <summarylogfilepath>$INSTALL_PATH/logs/InstallSummary.html</summarylogfilepath>
    </info>
    <variables>
        <variable name="product.name" value="${product.name}"/>
        <variable name="product.version" value="${project.version}"/>
        
        <!-- default values for DB driver -->
        <variable name="def.db.driver.mysql" value="com.mysql.jdbc.Driver"/>
        <variable name="def.db.driver.postgresql" value="org.postgresql.Driver"/>
        <variable name="def.db.driver.derby" value="org.apache.derby.jdbc.ClientDriver"/>

        <variable name="def.db.url.mysql" value="jdbc:mysql://localhost/jahia?useUnicode=true&amp;characterEncoding=UTF-8&amp;useServerPrepStmts=false"/>
        <variable name="def.db.url.postgresql" value="jdbc:postgresql://localhost:5432/jahia"/>
        <variable name="def.db.url.derby" value="jdbc:derby://localhost:1527/jahia;create=true"/>
        
        <variable name="superUser.username" value="root"/>
        
        <variable name="TargetPanel.noWhitespaces" value="true"/>
        
        <variable name="TargetPanel.dir.mac" value="$APPLICATIONS_DEFAULT_ROOT/Jahia_xCM_CE_v${project.version}"/>
        <variable name="TargetPanel.dir.macosx" value="$APPLICATIONS_DEFAULT_ROOT/Jahia_xCM_CE_v${project.version}"/>
        <variable name="TargetPanel.dir.unix" value="/usr/local/Jahia_xCM_CE_v${project.version}"/>
        <variable name="TargetPanel.dir.windows" value="C:\Jahia_xCM_CE_v${project.version}"/>
    </variables>
    <dynamicvariables>
        <variable name="jahia.war.contextName" value="" condition="cnd.installation.type.express"/>
        <variable name="jahia.war.contextPath" value="" condition="cnd.installation.type.express|cnd.contextPath.root"/>
        <variable name="jahia.war.contextPath" value="/${jahia.war.contextName}" condition="cnd.installation.type.advanced+!cnd.contextPath.root"/>
        <variable name="jahia.war.target.dir.name" value="ROOT" condition="cnd.contextPath.root"/>
        <variable name="jahia.war.target.dir.name" value="${jahia.war.contextName}" condition="!cnd.contextPath.root"/>
        <variable name="jahia.war.target.path" value="$INSTALL_PATH/tomcat/webapps/${jahia.war.target.dir.name}" condition="cnd.pack.tomcat"/>
        <variable name="jahia.war.target.path" value="$INSTALL_PATH/build" condition="!cnd.pack.tomcat"/>
        <variable name="jahia.tomcat.pack.selected" value="true" condition="cnd.pack.tomcat"/>
        <variable name="jahia.tomcat.pack.selected" value="false" condition="!cnd.pack.tomcat"/>
        
        <variable name="server.type" value="tomcat"/>
        
        <variable name="tomcat.httpPort" value="8080" condition="cnd.installation.type.express|!cnd.pack.tomcat"/>
        <variable name="tomcat.sslPort" value="8443" condition="cnd.installation.type.express|!cnd.pack.tomcat"/>
        <variable name="tomcat.ajpPort" value="8009" condition="cnd.installation.type.express|!cnd.pack.tomcat"/>
        <variable name="tomcat.serverPort" value="8005" condition="cnd.installation.type.express|!cnd.pack.tomcat"/>
        
        <variable name="jahiaManager.username" value="jahia" condition="cnd.installation.type.express"/>
        <variable name="jahiaManager.password" value="password" condition="cnd.installation.type.express"/>
        
        <variable name="developmentMode" value="true" condition="cnd.installation.type.express"/>

        <!-- embedded Derby defaults -->
        <variable name="dbSettings.dbms.type" value="derby_embedded" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.dbms.createTables" value="true" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.driver" value="org.apache.derby.jdbc.EmbeddedDriver" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.url" value="jdbc:derby:directory:jahia;create=true" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.username" value="" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.password" value="" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
        
        <variable name="superUser.firstname" value="" condition="cnd.installation.type.express"/>
        <variable name="superUser.lastname" value="" condition="cnd.installation.type.express"/>
        <variable name="superUser.email" value="" condition="cnd.installation.type.express"/>
        
        <!-- DB drivers for standalone DBMSs -->
        <variable name="dbSettings.connection.driver" value="${dbSettings.connection.driver.mysql}" condition="cnd.db.dbms.mysql" />
        <variable name="dbSettings.connection.driver" value="${dbSettings.connection.driver.postgresql}" condition="cnd.db.dbms.postgresql" />
        <variable name="dbSettings.connection.driver" value="${dbSettings.connection.driver.derby}" condition="cnd.db.dbms.derby" />

        <!-- DB URLs for standalone DBMSs -->
        <variable name="dbSettings.connection.url" value="${dbSettings.connection.url.mysql}" condition="cnd.db.dbms.mysql" />
        <variable name="dbSettings.connection.url" value="${dbSettings.connection.url.postgresql}" condition="cnd.db.dbms.postgresql" />
        <variable name="dbSettings.connection.url" value="${dbSettings.connection.url.derby}" condition="cnd.db.dbms.derby" />

		<!-- Store binary data on filesystem by default -->
		<variable name="dbSettings.dbms.storeFilesInDB" value="false" condition="cnd.installation.type.express|cnd.db.dbms.derby_embedded"/>
		
        <!-- mail settings -->
        <variable name="mailSettings.administrator" value="" condition="cnd.installation.type.express"/>
        <variable name="mailSettings.from" value="" condition="cnd.installation.type.express"/>
        <variable name="mailSettings.server" value="" condition="cnd.installation.type.express"/>
    </dynamicvariables>
    
    <conditions>
        <condition type="variable" id="cnd.installation.type.express">
            <name>installation.type</name>
            <value>express</value>
        </condition>
        <condition type="variable" id="cnd.installation.type.advanced">
            <name>installation.type</name>
            <value>advanced</value>
        </condition>
        
        <condition type="packselection" id="cnd.pack.tomcat">
            <packid>tomcat</packid>
        </condition>
        
        <condition type="variable" id="cnd.db.mode.standalone">
            <name>dbSettings.mode</name>
            <value>standalone</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.derby_embedded">
            <name>dbSettings.mode</name>
            <value>embedded</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.mysql">
            <name>dbSettings.dbms.type</name>
            <value>mysql</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.postgresql">
            <name>dbSettings.dbms.type</name>
            <value>postgresql</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.derby">
            <name>dbSettings.dbms.type</name>
            <value>derby</value>
        </condition>

        <condition type="variable" id="cnd.start.tomcat">
            <name>afterInstall.startTomcat</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="cnd.launch.jahia">
            <name>afterInstall.launchJahia</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="cnd.view.readme">
            <name>afterInstall.viewReadme</name>
            <value>true</value>
        </condition>
        <condition type="variable" id="cnd.view.howtoinstall">
            <name>afterInstall.viewHowToInstall</name>
            <value>true</value>
        </condition>
        <condition type="com.izforge.izpack.rules.EmptyVariableCondition" id="cnd.contextPath.root">
            <variable>jahia.war.contextName</variable>
        </condition>
    </conditions>
    <guiprefs height="480" resizable="yes" width="640">
        <modifier key="useFlags" value="no"/>
        <modifier key="langDisplayType" value="native"/>
        <modifier key="headingPanelCounter" value="progressbar"/>
        <modifier key="headingPanelCounterPos" value="inNavigationPanel"/>
        <modifier key="showDebugWindow" value="true"/>
    </guiprefs>
    <locale>
        <langpack iso3="eng"/>
        <langpack iso3="fra"/>
        <langpack iso3="deu"/>
        <langpack iso3="ita"/>
        <langpack iso3="por"/>
        <langpack iso3="spa"/>
    </locale>
    <resources>
        <res id="installer.langsel.img" src="../images/language-selection.png"/>
        <res id="Installer.image" src="../images/left-side.png"/>
        <res id="LicencePanel.licence" parse="no" src="../licenses/license.txt"/>

		<res id="AntActionsSpec.xml" src="AntActionsSpec.xml" />
        <res id="AntBuildFile" src="build-jahia.xml"/>

        <res id="ProcessPanel.Spec.xml" src="ProcessPanel.Spec.xml"/>

        <res id="shortcutSpec.xml" src="windows-shortcuts.xml"/>
        <res id="Unix_shortcutSpec.xml" src="unix-shortcuts.xml"/>

        <res id="userInputSpec.xml" src="userInputSpec.xml"/>
        <res id="userInputLang.xml_eng" src="i18n/userInputLang.eng.xml" />
        <res id="userInputLang.xml_fra" src="i18n/userInputLang.fra.xml" />
        <res id="userInputLang.xml_deu" src="i18n/userInputLang.deu.xml" />
        <res id="userInputLang.xml_ita" src="i18n/userInputLang.ita.xml" />
        <res id="userInputLang.xml_por" src="i18n/userInputLang.por.xml" />
        <res id="userInputLang.xml_spa" src="i18n/userInputLang.spa.xml" />

        <res id="packsLang.xml_eng" src="i18n/packsLang.eng.xml"/>
        <res id="packsLang.xml_fra" src="i18n/packsLang.fra.xml"/>
        <res id="packsLang.xml_deu" src="i18n/packsLang.deu.xml"/>
        <res id="packsLang.xml_ita" src="i18n/packsLang.ita.xml"/>
        <res id="packsLang.xml_por" src="i18n/packsLang.por.xml"/>
        <res id="packsLang.xml_spa" src="i18n/packsLang.spa.xml"/>

        <res id="CustomLangpack.xml_eng" src="i18n/customLang.eng.xml"/>
        <res id="CustomLangpack.xml_fra" src="i18n/customLang.fra.xml"/>
        <res id="CustomLangpack.xml_deu" src="i18n/customLang.deu.xml"/>
        <res id="CustomLangpack.xml_ita" src="i18n/customLang.ita.xml"/>
        <res id="CustomLangpack.xml_por" src="i18n/customLang.por.xml"/>
        <res id="CustomLangpack.xml_spa" src="i18n/customLang.spa.xml"/>
        
        <res id="CustomActionsLang.xml_eng" src="i18n/customLang.eng.xml"/>
        <res id="CustomActionsLang.xml_fra" src="i18n/customLang.fra.xml"/>
        <res id="CustomActionsLang.xml_deu" src="i18n/customLang.deu.xml"/>
        <res id="CustomActionsLang.xml_ita" src="i18n/customLang.ita.xml"/>
        <res id="CustomActionsLang.xml_por" src="i18n/customLang.por.xml"/>
        <res id="CustomActionsLang.xml_spa" src="i18n/customLang.spa.xml"/>
        
    </resources>
    <panels>
        <panel classname="HelloPanel"/>
        <panel classname="LicencePanel"/>
        <panel classname="TargetPanel"/>
        <panel classname="UserInputPanel" id="installType"/>
        <panel classname="PacksPanel" id="packsPanel" condition="cnd.installation.type.advanced"/>
        <panel classname="UserInputPanel" condition="cnd.installation.type.advanced" id="dbMode"/>
        <panel classname="UserInputPanel" condition="cnd.installation.type.advanced+cnd.db.mode.standalone" id="dbType"/>
        <panel classname="UserInputPanel" condition="cnd.installation.type.advanced+cnd.db.mode.standalone" id="dbSettings">
        	<actions>
        		<action stage="postvalidate" classname="org.jahia.izpack.DbConnectionValidationPanelAction"/>
        	</actions>
        </panel>
        <panel classname="UserInputPanel" id="appServer" condition="cnd.installation.type.advanced"/>
        <panel classname="UserInputPanel" id="superUser"/>
        <panel classname="UserInputPanel" condition="cnd.installation.type.advanced" id="mailSettings"/>
        <panel classname="SummaryPanel"/>
        <panel classname="ExtendedInstallPanel">
        	<actions>
        		<action stage="preactivate" classname="org.jahia.izpack.LockPrevButtonPanelAction"/>
        	</actions>
        </panel>
        <panel classname="ShortcutPanel" id="shortcutPanel">
            <actions>
                <action stage="preactivate" classname="org.jahia.izpack.LockPrevButtonPanelAction"/>
            </actions>
        </panel>
        <panel classname="UserInputPanel" id="afterInstall" condition="izpack.windowsinstall">
        	<actions>
        		<action stage="preactivate" classname="org.jahia.izpack.LockPrevButtonPanelAction"/>
        	</actions>
        </panel>
        <panel classname="ProcessPanel" condition="cnd.launch.jahia|cnd.view.readme|cnd.view.howtoinstall"/>
        <panel classname="SimpleFinishPanel"/>
    </panels>
    
    <native name="ShellLink_x64.dll" type="izpack">
        <os arch="amd64"/>
        <os arch="ia64"/>
        <os arch="x86_64"/>
    </native>
    <native name="ShellLink.dll" type="izpack">
        <os arch="ia32"/>
        <os arch="i386"/>
        <os arch="i486"/>
        <os arch="i586"/>
        <os arch="i686"/>
        <os arch="x86"/>
    </native>
     
    <listeners>
    	<listener installer="ProgressBarInstallerListener"/>
        <listener installer="SummaryLoggerInstallerListener"/>
	    <listener installer="AntActionInstallerListener"/>
    </listeners>

    <packs>
        <pack name="Jahia xCM Platform" id="core" preselected="yes" required="yes">
            <description/>
            <fileset dir="../licenses" targetdir="$INSTALL_PATH/licenses" override="true" />
            <fileset dir="../links" targetdir="$INSTALL_PATH/docs" override="true">
                <exclude name="HowToInstall.URL"/>
                <exclude name="OpenJahia*"/>
                <exclude name="Readme.URL"/>
            </fileset>
            <fileset dir="../links" targetdir="$INSTALL_PATH/docs" override="true" condition="!cnd.pack.tomcat">
                <include name="HowToInstall.URL"/>
            </fileset>
            <fileset dir="../artifacts/jahia-war" targetdir="${jahia.war.target.path}" override="true">
                <exclude name="WEB-INF/lib/juel-api-*.jar"/>
            </fileset>
            <fileset dir="../images" targetdir="$INSTALL_PATH/icons" override="true">
                <include name="jahia.ico"/>
                <include name="jahia.png"/>
            </fileset>
            <singlefile override="true" src="../scripts/openUrl.sh" target="$INSTALL_PATH/bin/openUrl.sh" os="unix"/>
            <singlefile override="true" src="install.properties" target="$INSTALL_PATH/logs/install.properties"/>
            <singlefile override="true" src="../dependency/configurators-standalone.jar" target="$INSTALL_PATH/configurators.jar"/>
            <singlefile override="true" src="../dependency/archivers-standalone.jar" target="$INSTALL_PATH/archivers.jar"/>
            <singlefile override="true" src="../artifacts/shared-libraries-all.zip" target="$INSTALL_PATH/shared-libraries.zip" condition="!cnd.pack.tomcat"/>
            <singlefile overrride="true" src="../docs/How-to-install-tomcat.html" target="$INSTALL_PATH/How-to-install.html" condition="!cnd.pack.tomcat"/>
            <parsable targetfile="$INSTALL_PATH/logs/install.properties" type="javaprop"/>
            <parsable targetfile="$INSTALL_PATH/docs/Readme.URL" condition="cnd.pack.tomcat"/>
            <parsable targetfile="$INSTALL_PATH/docs/HowToInstall.URL" condition="!cnd.pack.tomcat"/>
            <executable targetfile="$INSTALL_PATH/bin/openUrl.sh" os="unix"/>
        </pack>
        <pack name="Apache Tomcat" id="tomcat" preselected="yes" required="no">
            <description/>
            <fileset dir="../links" targetdir="$INSTALL_PATH" override="true">
                <include name="OpenJahia*"/>
            </fileset>
            <fileset dir="../links" targetdir="$INSTALL_PATH/docs" overrride="true">
                <include name="Readme.URL"/>
            </fileset>
            <fileset dir="../artifacts/apache-tomcat-${jahia.tomcat.version}" targetdir="$INSTALL_PATH/tomcat" override="true" />
            <file override="true" src="../artifacts/shared-libraries-all.zip" targetdir="$INSTALL_PATH/tomcat/lib" unpack="true"/>
            <fileset dir="../tomcat" targetdir="$INSTALL_PATH/tomcat" override="true" />
            <fileset dir="../scripts" targetdir="$INSTALL_PATH" override="true" condition="izpack.windowsinstall">
                <include name="st*.bat"/>
            </fileset>
            <fileset dir="../scripts" targetdir="$INSTALL_PATH" override="true" condition="!izpack.windowsinstall">
                <include name="st*.sh"/>
            </fileset>
            <fileset dir="../images" targetdir="$INSTALL_PATH/icons" override="true">
                <include name="st*.ico"/>
                <include name="st*.png"/>
            </fileset>
            <parsable targetfile="$INSTALL_PATH/startJahia.bat" type="shell" os="windows"/>
            <parsable targetfile="$INSTALL_PATH/startJahia.sh" type="shell" os="unix" />
            <parsable targetfile="$INSTALL_PATH/startJahia.sh" type="shell" os="mac" />
            <parsable targetfile="$INSTALL_PATH/stopJahia.bat" type="shell" os="windows"/>
            <parsable targetfile="$INSTALL_PATH/stopJahia.sh" type="shell" os="unix"/>
            <parsable targetfile="$INSTALL_PATH/stopJahia.sh" type="shell" os="mac"/>
            
            <parsable targetfile="$INSTALL_PATH/tomcat/bin/catalina.bat" type="shell" os="windows"/>
            <parsable targetfile="$INSTALL_PATH/tomcat/bin/catalina.sh" type="shell" os="unix" />
            <parsable targetfile="$INSTALL_PATH/tomcat/bin/catalina.sh" type="shell" os="mac" />
            
            <parsable targetfile="$INSTALL_PATH/OpenJahia.URL"/>
            <parsable targetfile="$INSTALL_PATH/OpenJahiaAdministration.URL"/>
            
            <parsable targetfile="$INSTALL_PATH/tomcat/conf/server.xml"/>
            
            <executable targetfile="$INSTALL_PATH/tomcat/bin/catalina.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/digest.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/setclasspath.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/shutdown.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/startup.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/tool-wrapper.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/version.sh" />
            <executable targetfile="$INSTALL_PATH/startJahia.sh" />
            <executable targetfile="$INSTALL_PATH/stopJahia.sh" />
        </pack>
        <!-- 
        <pack name="TODO: Jahia Unified Content Hub" id="juch" preselected="no" required="no">
            <description/>
        </pack>
        <pack name="TODO: Jahia Documentation" id="docs" preselected="no" required="no">
            <description/>
        </pack>
         -->
    </packs>

	<jar src="../artifacts/ant.jar" />
	<jar src="../artifacts/ant-launcher.jar" />
	
	<jar src="../dependency/derbyclient.jar" />
	<jar src="../dependency/mysql-connector-java.jar" />
	<jar src="../dependency/postgresql.jar" />

	<jar src="../dependency/jahia-installer-lib.jar" />
</installation>
