<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How to install Jahia xCM 6.5 on Apache Tomcat 6.0.x server</title>
    <style type="text/css">
		body {
		    font: 75% Arial, Helvetica, sans-serif;
		    background: #e3eaed;
		    margin: 20px 0;
		    padding: 0;
		    text-align: center;
		    color: #333;
		}
		#container {
		    width: 60em;
		    margin: 0 auto;
		    text-align: left;
		}
		#mainContent {
		    padding: 10px 20px;
		    background: #fff;
		}
		#footnote {
		    margin-top:20px;
		    font-size: 75%;
		    border-top: 1px solid #333;
		}
		#footer {
		    margin-bottom:0px;
		    padding: 0;
		    border-top: 1px solid #ebf1f3;
		}
		#footer p {
		    color: #666;
		    font-size: 75%;
		    margin: 0;
		    padding: 10px 20px;
		}
		#footer a {
		    color:#666;
		}
		ul,td,ol,ul,p,blockquote,div{
		  font-family:Arial;
		  font-size:12px;
		}
		p{
		  font-size:12px;
		  padding:0 0 10px 0;
		  margin:0;
		}
		h1{
		  font-size:24px;
		  font-weight:normal;
		  background-repeat:repeat-x;
		  background-position:bottom;
		}
		h2{
		  font-size:15px;
		  margin:10px 0 5px 0;
		  font-weight:bold;
		}
		h3{
		  font-size:13px;
		  margin:0;
		  font-weight:bold;
		}
		h4{
		  font-size:14px;
		  padding:0;
		}
		h4 a:link,h4 a:visited{
		  font-size:14px;
		}
		h4 a:hover{
		  font-size:14px;
		}
		h5{
		  font-size:12px;
		  font-weight:bold;
		  margin:0 0 5px 0;
		  padding:0;
		}
		h6{
		  font-size:11px;
		  margin:0 0 20px 0;
		}
		h1{
		  color:#333;
		}
		h2{
		  color:#be2a2e;
		}
		h3{
		  color:#333;
		}
		h4{
		  color:#333;
		}
		
		h5{
		  color:#333;
		}
		h6{
		  color:#3F748F;
		}
		a:link,a:visited{
		  color:#660099;
		}
		a:hover{
		  color:#330066;
		}
		legend{
			text-transform:uppercase;
			color:#a31b00;
			padding:0 0.5em;
			font-weight:bold
		}
    </style>
</head>
<body>
<div id="container">
  <div id="mainContent">
	<h1>How to install Jahia xCM 6.5 on Apache Tomcat 6.0.x server</h1>
	
	<h2>Installation</h2>
	<p>The installation procedure for Apache Tomcat 6 is as follows:</p>
    <ol>
        <li>Launch the installer</li>
        <li>Choose <em>Custom install (advanced)</em> installation type</li>
        <li>Select only <em>Jahia xCM Platform</em> pack</li>
        <li>Choose <em>Apache Tomcat 6.0.x</em> as the target application server type</li>
        <li>Follow the next steps of the installer</li>
    </ol>
    <p>Once the installer is finished in your install directory you should find a file named <tt>ROOT.war</tt>
    <sup>[<a href="#ftn.1">1</a>]</sup>, a file named <tt>shared-libraries.zip</tt> and if you chose to externalize
    the configuration you will also have a <tt>jahia-config.jar</tt> file.</p>
    
    <h2>Deployment</h2>
    <p>Further it is assumed that the Apache Tomcat server is installed in the <tt>&lt;tomcat&gt;</tt> folder.</p>
    <ol>
        <li>Unzip the content of the <tt>shared-libraries.zip</tt> file into your <tt>&lt;tomcat&gt;/lib</tt> directory.</li>
        <li>In case ROOT was configured as the Web application context name, please, remove or rename the default Tomcat ROOT Web application
        at <tt>&lt;tomcat&gt;/webapps/ROOT</tt>, if it exists, to e.g. <tt>tomcat</tt>.</li>
        <li>Copy the <tt>ROOT.war</tt><sup>[<a href="#ftn.1">1</a>]</sup> file to the <tt>&lt;tomcat&gt;/webapps</tt> directory
        or, in case your server does not automatically unpack WAR files, do it yourself.</li>
        <li>If you chose to externalize the configuration into a JAR file, either copy the <tt>jahia-config.jar</tt> file into the
        <tt>&lt;tomcat&gt;/lib</tt> directory, or modify the catalina.sh/bat files to add it to the classpath.</li>
		<li>Adjust the JVM, connector and servlet container options appropriately (see next sections).</li>
    </ol>
    
    <h2>JVM tuning options</h2>
	<p>The default JVM options in the Tomcat's startup script (<tt>&lt;tomcat&gt;/bin/catalina.bat</tt> or <tt>&lt;tomcat&gt;/bin/catalina.sh</tt>)
			should be adjusted to use server JVM ("<tt>-server</tt>" option), have at least 1 GB<sup>[<a href="#ftn.2">2</a>]</sup> heap size (<tt>-Xms1024m -Xmx1024m</tt>)
        	and at least 256 MB<sup>[<a href="#ftn.2">2</a>]</sup> as a limit for the permanent generation heap size (<tt>-XX:MaxPermSize=256m</tt>), if applicable,
        	also adding another tuning options.</p>
    <p>This can be done by adding the following line to your <tt>&lt;tomcat&gt;/bin/catalina.bat</tt> (Windows OS):</p>
    <blockquote><p><tt>set CATALINA_OPTS=%CATALINA_OPTS% -Dsun.io.useCanonCaches=false -Xms1024m -Xmx1024m -XX:MaxPermSize=256m -server -Dhibernate.jdbc.use_streams_for_binary=true -verbose:gc -XX:+HeapDumpOnOutOfMemoryError</tt></p></blockquote>
    <p>or to the <tt>&lt;tomcat&gt;/bin/catalina.sh</tt> file (non Windows OS):</p>
    <blockquote><p><tt>CATALINA_OPTS="$CATALINA_OPTS -Xms1024m -Xmx1024m -Djava.awt.headless=true -XX:MaxPermSize=256m -server -Dhibernate.jdbc.use_streams_for_binary=true -verbose:gc -XX:+HeapDumpOnOutOfMemoryError"</tt></p></blockquote>
    
    <h2>HTTP/AJP connector tuning options</h2>
    <p>The following configuration for the HTTP and AJP connectors (configured in the <tt>&lt;tomcat&gt;/conf/server.xml</tt> file) is recommended<sup>[<a href="#ftn.3">3</a>]</sup>,
    which includes UTF-8 URI encoding, compression of the response content etc.:</p>
    <blockquote>
    <p>
    <tt>&lt;Connector port="8080" protocol="HTTP/1.1"<br/>
        &nbsp;&nbsp;&nbsp;connectionTimeout="20000"<br/>
        &nbsp;&nbsp;&nbsp;redirectPort="8443"<br/>
        &nbsp;&nbsp;&nbsp;maxThreads="300" acceptCount="100"<br/>
        &nbsp;&nbsp;&nbsp;enableLookups="false"<br/>
        &nbsp;&nbsp;&nbsp;emptySessionPath="true" URIEncoding="UTF-8"<br/>
        &nbsp;&nbsp;&nbsp;compression="on"<br/>
        &nbsp;&nbsp;&nbsp;compressableMimeType="text/plain,text/html,text/xml,text/css,text/javascript,application/x-javascript,application/javascript" /&gt;</tt>
	</p>
	</blockquote>
    <blockquote>
    <p>
    <tt>&lt;Connector port="8009" protocol="AJP/1.3" redirectPort="8443"<br/>
    &nbsp;&nbsp;&nbsp;enableLookups="false" emptySessionPath="true"<br/>
    &nbsp;&nbsp;&nbsp;URIEncoding="UTF-8" maxThreads="300" /&gt;</tt>
    </p>
    </blockquote>
    
    <h2>JSP Compiler/Servlet tuning options</h2>
    <p>JSP Servlet parameters (configured in the <tt>&lt;tomcat&gt;/conf/web.xml</tt> file) can be optimized in the following way:</p>
    <pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;fork&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;trimSpaces&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;genStrAsCharArray&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;development&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;checkInterval&lt;/param-name&gt;
            &lt;param-value&gt;300&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;xpoweredBy&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    </pre>
    
    <p>In production you can set the <tt>development</tt> parameter to <tt>false</tt> to prevent compiler checking
    for JSP modifications too often and enable background compilation with <tt>checkInterval</tt> seconds.
	</p>
    
    <div id="footnote">
    	<p>
    	<sup>[<a name="ftn.1">1</a>]</sup>&nbsp;The name of the WAR file corresponds to the configured Web application context name<br/>
    	<sup>[<a name="ftn.2">2</a>]</sup>&nbsp;For production systems the memory options should be adjusted accordingly to achieve high performance and scalability 
    	<sup>[<a name="ftn.3">3</a>]</sup>&nbsp;Connector settings, especially <tt>maxThreads</tt> and <tt>acceptCount</tt> values, should be adjusted accordingly to achieve high performance and scalability in production run 
    	</p>
	</div>
  </div>
  <div id="footer">
    <p>Copyright &copy; 2002-2011 Jahia Solutions Group. All rights reserved.</p>
  </div>
</div>
</body>
</html>